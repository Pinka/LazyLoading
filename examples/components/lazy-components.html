<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Component Lazy Loading</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }

      h1,
      h2,
      h3 {
        color: #333;
      }

      .explanation {
        background-color: #f8f9fa;
        border-left: 4px solid #007bff;
        padding: 15px;
        margin-bottom: 20px;
      }

      .component-container {
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 20px;
        margin-bottom: 20px;
      }

      button {
        background-color: #4caf50;
        color: white;
        border: none;
        padding: 10px 15px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 4px;
      }

      button:hover {
        background-color: #45a049;
      }

      pre {
        background-color: #f1f1f1;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        font-family: monospace;
      }

      code {
        background-color: #f1f1f1;
        padding: 2px 4px;
        border-radius: 4px;
        font-family: monospace;
      }

      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100px;
      }

      .loading::after {
        content: "Loading...";
        color: #666;
      }

      .chart-container {
        height: 300px;
        width: 100%;
      }

      .weather-widget {
        background-color: #f0f8ff;
        padding: 15px;
        border-radius: 4px;
      }

      .comments-section {
        background-color: #f9f9f9;
        padding: 15px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <h1>Component Lazy Loading</h1>

    <div class="explanation">
      <h2>How It Works</h2>
      <p>
        This example demonstrates lazy loading of UI components using vanilla
        JavaScript. Components are loaded only when needed, typically when a
        user interacts with the page or when a component is about to become
        visible.
      </p>
      <p>Benefits of lazy loading components:</p>
      <ul>
        <li>Reduces initial page load time</li>
        <li>Saves resources by loading only what's needed</li>
        <li>Improves perceived performance</li>
        <li>Allows for more modular code organization</li>
      </ul>
      <p>Click the buttons below to load different components on demand.</p>
    </div>

    <div class="component-container">
      <h2>Chart Component</h2>
      <p>
        This component loads a chart library (Chart.js) only when requested.
      </p>
      <button id="load-chart">Load Chart Component</button>
      <div id="chart-placeholder"></div>
    </div>

    <div class="component-container">
      <h2>Weather Widget</h2>
      <p>This component simulates loading weather data from an API.</p>
      <button id="load-weather">Load Weather Widget</button>
      <div id="weather-placeholder"></div>
    </div>

    <div class="component-container">
      <h2>Comments Section</h2>
      <p>This component loads a comments section with data.</p>
      <button id="load-comments">Load Comments</button>
      <div id="comments-placeholder"></div>
    </div>

    <div class="explanation">
      <h2>The Code</h2>
      <h3>Dynamic Script Loading</h3>
      <pre>
function loadScript(url) {
  return new Promise((resolve, reject) => {
    const script = document.createElement('script');
    script.src = url;
    script.onload = resolve;
    script.onerror = reject;
    document.head.appendChild(script);
  });
}

// Usage
document.getElementById('load-chart').addEventListener('click', async () => {
  const placeholder = document.getElementById('chart-placeholder');
  placeholder.className = 'loading';
  
  try {
    // Load Chart.js library dynamically
    await loadScript('https://cdn.jsdelivr.net/npm/chart.js');
    
    // Now that Chart.js is loaded, create and render the chart
    renderChart(placeholder);
  } catch (error) {
    placeholder.textContent = 'Failed to load chart component';
  }
});
        </pre
      >

      <h3>Component Factory Pattern</h3>
      <pre>
// Component factory - creates components on demand
const ComponentFactory = {
  createWeatherWidget: async function() {
    // Simulate API fetch delay
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    const widget = document.createElement('div');
    widget.className = 'weather-widget';
    widget.innerHTML = `
      <h3>Weather Forecast</h3>
      <p>New York: 72°F, Sunny</p>
      <p>London: 65°F, Cloudy</p>
      <p>Tokyo: 80°F, Partly Cloudy</p>
    `;
    
    return widget;
  },
  
  createCommentsSection: async function() {
    // Simulate API fetch delay
    await new Promise(resolve => setTimeout(resolve, 1500));
    
    const comments = document.createElement('div');
    comments.className = 'comments-section';
    comments.innerHTML = `
      <h3>Recent Comments</h3>
      <div class="comment">
        <p><strong>User1:</strong> Great article!</p>
      </div>
      <div class="comment">
        <p><strong>User2:</strong> Thanks for sharing this information.</p>
      </div>
      <div class="comment">
        <p><strong>User3:</strong> I learned a lot from this.</p>
      </div>
    `;
    
    return comments;
  }
};
        </pre>
    </div>

    <p><a href="../index.html">Back to Examples</a></p>

    <script>
      // Function to dynamically load a script
      function loadScript(url) {
        return new Promise((resolve, reject) => {
          const script = document.createElement("script");
          script.src = url;
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        });
      }

      // Component factory - creates components on demand
      const ComponentFactory = {
        createWeatherWidget: async function () {
          // Simulate API fetch delay
          await new Promise((resolve) => setTimeout(resolve, 1000));

          const widget = document.createElement("div");
          widget.className = "weather-widget";
          widget.innerHTML = `
                    <h3>Weather Forecast</h3>
                    <p>New York: 72°F, Sunny</p>
                    <p>London: 65°F, Cloudy</p>
                    <p>Tokyo: 80°F, Partly Cloudy</p>
                `;

          return widget;
        },

        createCommentsSection: async function () {
          // Simulate API fetch delay
          await new Promise((resolve) => setTimeout(resolve, 1500));

          const comments = document.createElement("div");
          comments.className = "comments-section";
          comments.innerHTML = `
                    <h3>Recent Comments</h3>
                    <div class="comment">
                        <p><strong>User1:</strong> Great article!</p>
                    </div>
                    <div class="comment">
                        <p><strong>User2:</strong> Thanks for sharing this information.</p>
                    </div>
                    <div class="comment">
                        <p><strong>User3:</strong> I learned a lot from this.</p>
                    </div>
                `;

          return comments;
        },
      };

      // Function to render chart
      function renderChart(container) {
        container.className = "chart-container";

        const canvas = document.createElement("canvas");
        container.innerHTML = "";
        container.appendChild(canvas);

        new Chart(canvas, {
          type: "bar",
          data: {
            labels: ["January", "February", "March", "April", "May", "June"],
            datasets: [
              {
                label: "Monthly Sales",
                data: [12, 19, 3, 5, 2, 3],
                backgroundColor: [
                  "rgba(255, 99, 132, 0.2)",
                  "rgba(54, 162, 235, 0.2)",
                  "rgba(255, 206, 86, 0.2)",
                  "rgba(75, 192, 192, 0.2)",
                  "rgba(153, 102, 255, 0.2)",
                  "rgba(255, 159, 64, 0.2)",
                ],
                borderColor: [
                  "rgba(255, 99, 132, 1)",
                  "rgba(54, 162, 235, 1)",
                  "rgba(255, 206, 86, 1)",
                  "rgba(75, 192, 192, 1)",
                  "rgba(153, 102, 255, 1)",
                  "rgba(255, 159, 64, 1)",
                ],
                borderWidth: 1,
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
      }

      // Event listeners for loading components
      document
        .getElementById("load-chart")
        .addEventListener("click", async function () {
          const button = this;
          const placeholder = document.getElementById("chart-placeholder");

          // Disable button to prevent multiple clicks
          button.disabled = true;
          button.textContent = "Loading...";

          // Show loading state
          placeholder.className = "loading";

          try {
            // Load Chart.js library dynamically
            await loadScript("https://cdn.jsdelivr.net/npm/chart.js");

            // Now that Chart.js is loaded, create and render the chart
            renderChart(placeholder);

            // Update button
            button.textContent = "Chart Loaded";
          } catch (error) {
            placeholder.textContent = "Failed to load chart component";
            button.textContent = "Retry Loading Chart";
            button.disabled = false;
          }
        });

      document
        .getElementById("load-weather")
        .addEventListener("click", async function () {
          const button = this;
          const placeholder = document.getElementById("weather-placeholder");

          // Disable button to prevent multiple clicks
          button.disabled = true;
          button.textContent = "Loading...";

          // Show loading state
          placeholder.className = "loading";

          try {
            // Create and render weather widget
            const weatherWidget = await ComponentFactory.createWeatherWidget();

            // Clear loading state and append widget
            placeholder.className = "";
            placeholder.innerHTML = "";
            placeholder.appendChild(weatherWidget);

            // Update button
            button.textContent = "Weather Loaded";
          } catch (error) {
            placeholder.textContent = "Failed to load weather widget";
            button.textContent = "Retry Loading Weather";
            button.disabled = false;
          }
        });

      document
        .getElementById("load-comments")
        .addEventListener("click", async function () {
          const button = this;
          const placeholder = document.getElementById("comments-placeholder");

          // Disable button to prevent multiple clicks
          button.disabled = true;
          button.textContent = "Loading...";

          // Show loading state
          placeholder.className = "loading";

          try {
            // Create and render comments section
            const commentsSection =
              await ComponentFactory.createCommentsSection();

            // Clear loading state and append comments
            placeholder.className = "";
            placeholder.innerHTML = "";
            placeholder.appendChild(commentsSection);

            // Update button
            button.textContent = "Comments Loaded";
          } catch (error) {
            placeholder.textContent = "Failed to load comments";
            button.textContent = "Retry Loading Comments";
            button.disabled = false;
          }
        });
    </script>
  </body>
</html>
